(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n),document.addEventListener("click",r)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("click",r),document.removeEventListener("keydown",n)}function n(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function r(e){e.target.classList.contains("popup_is-opened")&&t(e.target)}var o=function(e,t){var n=e.querySelector(".".concat(t.id,"_error"));t.classList.remove("popup__input_error_active"),t.classList.remove("input_error_underline"),n.classList.remove("popup__input_error_active"),n.textContent=""},c=function(){Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");i(t,n),t.forEach((function(r){r.addEventListener("input",(function(){!function(e,t){t.validity.valueMissing?t.setCustomValidity("Вы пропустили это поле."):t.setCustomValidity(""),t.validity.patternMismatch&&t.setCustomValidity(t.dataset.errorMessage),t.validity.valid?o(e,t):(function(e,t,n){var r=e.querySelector(".".concat(t.id,"_error"));t.classList.add("popup__input_error_active"),r.textContent=n,r.classList.add("popup__input_error_active")}(e,t,t.validationMessage),t.classList.add("input_error_underline"))}(e,r),i(t,n)}))}))}(e)}))},a=function(e){var t=e.querySelector(".popup__form");Array.from(e.querySelectorAll(".popup__input")).forEach((function(e){o(t,e)}))};function i(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove("popup__button-disabled"):t.classList.add("popup__button-disabled")}var u=document.querySelector("#card-template").content,s=document.querySelector(".places__list");function l(e,t,n,r,o,c,a,i,l,p,_,f){var v=u.querySelector(".card").cloneNode(!0),m=v.querySelector(".card__title"),y=v.querySelector(".card__image"),h=v.querySelector(".card__delete-button"),S=v.querySelector(".card__like-button"),b=v.querySelector(".like__counter");return m.textContent=e,y.alt=e,y.src=t,b.textContent=n.length,"7341fc8cf4cc22fe7c6daef9"!=r&&v.removeChild(h),h.addEventListener("click",(function(){c(i),i.querySelector(".popup__button").addEventListener("click",(function(){console.log("карточка ".concat(o," удалена")),p(o),a(i),v.remove()}))})),0!=n.length&&n.forEach((function(e){"7341fc8cf4cc22fe7c6daef9"===e._id&&S.classList.add("card__like-button_is-active")})),S.addEventListener("click",d(o,_,f,b)),s.addEventListener("click",l),v}var d=function(e,t,n,r){return function(o){var c=o.target.classList.contains("card__like-button"),a=o.target.classList.contains("card__like-button_is-active");if(c&&!a){o.target.classList.add("card__like-button_is-active"),t(e);var i=Number(r.textContent)+1;r.textContent=i}if(a){o.target.classList.remove("card__like-button_is-active"),n(e);var u=Number(r.textContent)-1;r.textContent=u}}},p={baseUrl:"https://nomoreparties.co/v1/wff-cohort-11",headers:{authorization:"8d3fd7a5-fe5c-45bd-a76a-627c88eada83","Content-Type":"application/json"}},_=function(e){return fetch("".concat(p.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:p.headers})},f=function(e){return fetch("".concat(p.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:p.headers})},v=function(e){return fetch("".concat(p.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:p.headers})},m=document.querySelector(".content"),y=m.querySelector(".places__list"),h=m.querySelector(".profile__add-button"),S=m.querySelector(".profile__edit-button"),b=document.querySelector(".popup_type_edit"),L=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_image"),k=document.querySelector(".popup_delete"),E=document.querySelector(".popup_avatar_edit"),g=b.querySelector(".popup__close"),C=L.querySelector(".popup__close"),x=q.querySelector(".popup__close"),U=k.querySelector(".popup__close"),A=E.querySelector(".popup__close"),P=document.querySelector(".profile"),N=P.querySelector(".profile__title"),T=P.querySelector(".profile__description"),w=P.querySelector(".profile__image"),D=document.querySelector(".popup__image"),j=document.querySelector(".popup__caption"),M=document.forms.editProfile,O=M.elements.name,J=M.elements.description,V=document.forms.newPlace,H=V.elements.placeName,I=V.elements.link,z=document.forms.editAvatar,B=z.elements.avatar;function F(t){if(t.target.classList.contains("card__image")){var n=t.target.alt,r=t.target.src;D.src=r,D.alt=n,j.textContent=n,e(q)}}S.addEventListener("click",(function(){e(b),a(b),b.querySelector(".popup__button").classList.remove("popup__button-disabled"),O.value=N.textContent,J.value=T.textContent})),h.addEventListener("click",(function(){e(L),a(L),V.reset(),c()})),w.addEventListener("click",(function(){e(E),a(E),z.reset()})),V.addEventListener("submit",(function(e){var n,r;e.preventDefault(),n=H.value,r=I.value,fetch("".concat(p.baseUrl,"/cards "),{method:"POST",headers:p.headers,body:JSON.stringify({name:n,link:r})}),t(L)})),M.addEventListener("submit",(function(e){var n,r;e.preventDefault(),n=O.value,r=J.value,fetch("".concat(p.baseUrl,"/users/me"),{method:"PATCH",headers:p.headers,body:JSON.stringify({name:n,about:r})}),t(b),N.textContent=O.value,T.textContent=J.value})),z.addEventListener("submit",(function(e){var n;e.preventDefault(),n=B.value,fetch("".concat(p.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:p.headers,body:JSON.stringify({avatar:n})}),t(E),w.style.backgroundImage="url(".concat(B.value,")")})),g.addEventListener("click",(function(){t(b)})),C.addEventListener("click",(function(){t(L)})),x.addEventListener("click",(function(){t(q)})),U.addEventListener("click",(function(){t(k)})),A.addEventListener("click",(function(){t(E)})),fetch("".concat(p.baseUrl,"/users/me"),{headers:p.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){N.textContent=e.name,T.textContent=e.about,w.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){console.log(e)})),fetch("".concat(p.baseUrl,"/cards"),{headers:p.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(n){for(var r=0;r<n.length;r++){var o=l(n[r].name,n[r].link,n[r].likes,n[r].owner._id,n[r]._id,e,t,k,F,_,f,v);y.append(o)}})).catch((function(e){console.log(e)})),c()})();